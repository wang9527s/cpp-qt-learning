
## 章节目录

[TOC]

## 1. window 常量中有换行符

&emsp;&emsp;本质是中文编码的问题

+ 尝试：

```cpp
1、改为utf8编码；　　　　               ✘  
2、QStringListeral；　　　　            ✘  
3、tr("   ");最后一个字符是英文　　 勉强√　//编译不报错。前半部分显示正常，后半部分乱码
4、改为utf8-bom编码，基本               √。（20210311）
```

如果还是不行，清除构建后，重新打开ide，然后构建

## 2. 小知识点

```cpp
2、图片加载失败：可能是因为图片太大  
3、窗口创建时是默认隐藏的，需要人为显示创建show()  
4、加载插件是注意路径的“\”和"/"，如果加载失败，路径错误不报错！
5、cannot find pro文件，工程目录中有中文路径。


7、第17篇 2D绘图（七）涂鸦板
https://wizardforcel.gitbooks.io/qt-beginning/content/21.html


10、跨工程传输数据：文件、数据库
    PS:现在使用单例，单例里面存放信号（20210311）
11、navicat_x64配合Oracle客户端（64位）的基础包，即可实现访问oracle服务器（32或64位）

14、paintEvent调用painter绘制
    其间一个获取数据的接口使用QEventLoop.exec()阻塞获取数据。导致程序崩溃！不理解
```

## 3. 应用程序图标

+ windows

&emsp;&emsp;在代码目录中放置名为icon.ico的图片（不可以是png等文件重命名产生的）；新建icon.rc文件并添加到工程中，文件内容如下：

```cpp
IDI_ICON1       ICON        "icon.ico"
```

+ linux  

&emsp;&emsp;修改desktop中的Icon

## 4. 多线程中调用同一个函数

&emsp;&emsp;在gui中开辟线程多个调用dll函数（输出功能），可以发现：  
&emsp;&emsp;&emsp;&emsp;程序会在一个dll函数结束后再次调用，而不会同时运行多个副本。 TODO: verify

## 5. 开启鼠标跟踪

&emsp;&emsp;setMouseTracking(false)，默认是false ，mouseMoveEvent无法捕获鼠标移动，只有点击后才可以。设置setMouseTracking(true)后，在鼠标点击前，也可以捕获鼠标移动。

## 6. isNull和isEmpty

```cpp
QString().isNull();         // true
QString().isEmpty();        // true
QString("").isNull();       // false
QString("").isEmpty();      // true
```

## 7. 内存泄露和内存越界

&emsp;&emsp;内存泄露：控件没有释放  
&emsp;&emsp;内存溢出/越界：访问越界 

&emsp;&emsp;**注意**，dump日志指向完全不相干的模块，实际上是内存越界。

## 8. 槽函数的执行时间

+ 场景

```cpp
class Window{
    vector<BookInfo> infos;

    void A(){
        infos.append
        infos.remove
        B()
        infos[id].num = 10
        infos.remove
    }
    void B(){
        .....
    }
public slots:
    void on_show_book(int id){
        infos[id]
    }
};

我遇到的问题是 on_show_book()中访问infos出现越界情况。不是很理解。

信号不会打断当前函数，在当前函数执行完后，进入下有一次事件循环的时候，才会调用槽函数。

假如当前函数运行在A->B中，也应该在b执行完后回到a并且a也执行完，才会调用槽函数。

// 加log 多次复现。
最后发现，B调用的子函数中存在QCoreApplication::processEvents()语句。结果就是b被打断，执行完槽函数后，再继续执行B剩下的部分
```

## 添加水印

&emsp;&emsp;window测试通过，界面指定且鼠标可以穿透。

```cpp
    QWidget w;
    w.resize(100, 100);
    w.move(2000,0);
    w.setStyleSheet("background:red;");
    w.setWindowFlags(Qt::WindowTransparentForInput | Qt::Tool | Qt::X11BypassWindowManagerHint | Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint);
    w.setAttribute(Qt::WA_TransparentForMouseEvents);
    w.show();
```

## 设置系统壁纸

```cpp
    QString imagePath("D:\\disk\\my_pixture\\DSC01004.JPG");
    QByteArray byte = imagePath.toLocal8Bit();
    SystemParametersInfoA(SPI_SETDESKWALLPAPER,0,byte.data(),
                          SPIF_UPDATEINIFILE | SPIF_SENDWININICHANGE);
```